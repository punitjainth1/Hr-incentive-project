# Hr-incentive-project
incentive are given according to the work_hour of an CREATE OR REPLACE PROCEDURE            HR_INCENTIVE_PLAN_BKP
IS
BEGIN

    DELETE  FROM ERS$HITESH.HR_INCENTIVE_SALES WHERE MONTH_YEAR='JUN_23';
    COMMIT;

    INSERT INTO ERS$HITESH.HR_INCENTIVE_SALES

    SELECT MONTH_YEAR,SAL.ADMSITE_CODE,S.SHRTNAME SITE_NAME,I.GROUP_ALIAS
    ,SUM(SAL.QTY) SALE_QTY,SUM(SAL.NETAMT) NET_SALE
    FROM 
    --SALE DATA START
     (--OFFLINE SALES
            SELECT ADMSITE_CODE
            ,ICODE,TO_CHAR(BILLDATE,'MON_RR') MONTH_YEAR
            ,SUM(NVL(QTY,0)) QTY,SUM(NVL(NETAMT,0)) NETAMT
            FROM VMHO.FACT_POS_SALE_DET_MV@HITESH_TOVMRL
                      WHERE TO_CHAR(BILLDATE,'MON_RR')='JUN_23'
                      GROUP BY ADMSITE_CODE,ICODE,TO_CHAR(BILLDATE,'MON_RR')
            UNION ALL
            --ONLINE SALES
            SELECT PB.ADMSITE_CODE
            ,PBI.ICODE,TO_CHAR(PB.CSDATE,'MON_RR') MONTH_YEAR
            ,SUM(NVL(PB.QTY,0)) QTY,SUM(NVL(PBI.NETAMT,0)) NETAMT
            FROM VMHO.SALCSMAIN@db_link_to_READ pb,
                          VMHO.SALCSDET@db_link_to_READ pbi
                      WHERE pb.CScode = pbi.CScode
                      and pb.scheme_docno not in ('NOVEMBER_INVOICE_1', 'OCTOBER_INVOICE_1', 'SEPTEMBER_INVOICE_1')
                      AND PB.CHANNELTYPE = 'ETL'
                      AND TO_CHAR(CSDATE,'MON_RR')='JUN_23'
                      GROUP BY PB.ADMSITE_CODE,PBI.ICODE,TO_CHAR(PB.CSDATE,'MON_RR')
          ) SAL --SALE DATA END 
          ,ADMSITE S,ITEM_MVH I
    WHERE SAL.ADMSITE_CODE=S.CODE
    AND SAL.ICODE=I.ICODE
    --AND TO_CHAR(BILLDATE,'MON_RR')=TO_CHAR(SYSDATE,'MON_RR')
    --AND S.CODE=1
    GROUP BY MONTH_YEAR,SAL.ADMSITE_CODE,S.SHRTNAME ,I.GROUP_ALIAS
    ORDER BY SAL.ADMSITE_CODE,S.SHRTNAME ,I.GROUP_ALIAS ASC;

    COMMIT;




        DELETE  FROM ERS$HITESH.HR_INCENTIVE_FINAL_TBL WHERE MONTH_YEAR='JUN_23';
        INSERT INTO  ERS$HITESH.HR_INCENTIVE_FINAL_TBL
            SELECT MONTH_YEAR, EMP_CODE, EMP_NAME, GROUP_ALIAS, SITE_CODE, SITE_NAME
        , DESIGNATION, TOTAL_PRESENT, TARGET_AMT, NET_SALE, ACHMNT_PERCENT, INCENTIVE
        FROM 
        (/*******************GROUP ALIAS WISE INCENTIVE ***********************/
        SELECT INC.MONTH_YEAR,INC.EMP_CODE,INC.EMP_NAME,INC.GROUP_ALIAS,INC.SITE_CODE,INC.SITE_NAME
        ,INC.DESIGNATION
        ,INC.TOTAL_PRESENT
        ,INC.TARGET_AMT
        ,INC.NET_SALE
        ,INC.ACHMNT_PERCENT
        ,CASE WHEN INC.ACHMNT_PERCENT = MX.ACHMNT_PERCENT THEN INCENTIVE ELSE 0 END INCENTIVE
        FROM
        (SELECT A.MONTH_YEAR
        ,C.EMP_CODE
        ,C.EMP_NAME
        ,D.GROUP_ALIAS
        ,A.SITE_CODE
        ,A.SITE_NAME
        ,C.DESIGNATION
        ,C.TOTAL_PRESENT
        ,A.TARGET_AMT
        ,B.NET_SALE
        ,ROUND(DECODE(B.NET_SALE,0,1,B.NET_SALE)/DECODE(A.TARGET_AMT,0,1,A.TARGET_AMT)*100,2) ACHMNT_PERCENT,
        --CASE WHEN DECODE(B.NET_SALE,0,0.1,B.NET_SALE)/DECODE(A.TARGET_AMT,0,0.1,A.TARGET_AMT) * 100 > 100
        --AND D.GROUP_ALIAS NOT IN ('FOOD','STPLS','N-FOOD') AND C.DESIGNATION NOT IN ('FLOOR MANAGER') THEN 500
        --WHEN DECODE(B.NET_SALE,0,1,B.NET_SALE)/DECODE(A.TARGET_AMT,0,1,A.TARGET_AMT) * 100>100 --AND D.GROUP_ALIAS IN ('FOOD','STPLS','N-FOOD')
        --THEN 750
        --WHEN SUM(A.TARGET_AMT)<SUM(B.NET_SALE) AND C.DESIGNATION IN ('ASM') THEN 3000 ELSE 0
        --END INCENTIVE
        CASE WHEN B.NET_SALE> A.TARGET_AMT AND A.TARGET_AMT>75000
        --AND D.GROUP_ALIAS NOT IN ('FOOD','STPLS','N-FOOD')
        AND C.DESIGNATION NOT IN ('Floor Manager')  
        AND C.TOTAL_PRESENT >= 20
        THEN 500
        --WHEN B.NET_SALE> A.TARGET_AMT AND A.TARGET_AMT>75000 AND DESIGNATION='FMCG-Purchaser' --AND D.GROUP_ALIAS IN ('FOOD','STPLS','N-FOOD')
        --THEN 750
        ELSE 0 END INCENTIVE
        FROM V_HR_INCENTIVE_TARGET A,V_HR_INCENTIVE_SALES B,HR_ATTENDANCEWORKPIVOT C, HR_MONTHLYGROUPALIASUPDATE D
        WHERE A.MONTH_YEAR= B.MONTH_YEAR
        AND A.SITE_CODE = B.ADMSITE_CODE
        AND A.GROUP_ALIAS=B.GROUP_ALIAS
        AND A.MONTH_YEAR= D.MONTHYEAR
        AND A.SITE_CODE = D.STORECODE
        AND A.GROUP_ALIAS=D.GROUP_ALIAS
        AND C.EMP_CODE = D.EMP_CODE
        AND C.STORE=D.STORE
        AND B.MONTH_YEAR=C.MONTH_YEAR
        --AND A.MONTH_YEAR='JAN_23'
        --AND A.SITE_NAME='RANCHI-STATION ROAD'
        --AND C.EMP_CODE IN ('703573')
        GROUP BY A.MONTH_YEAR,C.EMP_CODE,C.EMP_NAME,D.GROUP_ALIAS,A.SITE_CODE,A.TARGET_AMT,A.SITE_NAME,B.NET_SALE,C.DESIGNATION,C.TOTAL_PRESENT) INC,
        HR_INCENTIVE_MAX MX
        WHERE INC.MONTH_YEAR=MX.MONTH_YEAR
        AND   INC.EMP_CODE=MX.EMP_CODE
        AND   INC.SITE_CODE=MX.SITE_CODE
        AND   INC.MONTH_YEAR='JUN_23'
        --ORDER BY INC.SITE_CODE,INC.EMP_CODE,INC.GROUP_ALIAS
        /*******************GROUP ALIAS WISE INCENTIVE END ***********************/
        UNION ALL
        /*******************FLOOR MANAGER WISE INCENTIVE***********************/
        SELECT TRGT.MONTH_YEAR,ATND.EMP_CODE,ATND.EMP_NAME,TRGT.GROUP_ALIAS,TRGT.SITE_CODE,TRGT.SITE_NAME,ATND.DESIGNATION,ATND.TOTAL_PRESENT,TRGT.TARGET_AMT,NTSL.NET_SALE
        ,SUM(NTSL.NET_SALE)/SUM(TRGT.TARGET_AMT) *100 ACHIVIMENT,
        CASE WHEN SUM(NTSL.NET_SALE)/SUM(TRGT.TARGET_AMT) *100 > 100 AND ATND.TOTAL_PRESENT>=20 THEN 750
        ELSE 0 END INCENTIVE
        FROM
        --TARGET AMOUNT AT DIVISION LEVEL FOR FLOOR MANAGERS
        (SELECT MONTH_YEAR,SITE_NAME,SITE_CODE
        ,CASE WHEN GROUP_ALIAS IN ('FOOD','N-FOOD','STPLS') THEN 'FMCG'
              WHEN GROUP_ALIAS IN ('MU-TEE','MU-SHRT','M-LWR','M-ETN','M-ACC') THEN 'MENS'
              WHEN GROUP_ALIAS IN ('LU-TOP','LU-ETN','L-LOW','L-ACC','SAR') THEN 'LADIES'
              WHEN GROUP_ALIAS IN ('KG-UPR','KG-SETS','KG-LWR','KB-UPR','KB-SETS','KB-LWR','K-ACC','INFT') THEN 'KIDS'
              ELSE GROUP_ALIAS END GROUP_ALIAS,SUM(TARGET_AMT) TARGET_AMT
         FROM V_HR_INCENTIVE_TARGET A 
         WHERE A.GROUP_ALIAS IN ('SAR','FOOD','N-FOOD','STPLS','MU-TEE','MU-SHRT','M-LWR','M-ETN','M-ACC','LU-TOP','LU-ETN','L-LOW','L-ACC','KG-UPR','KG-SETS','KG-LWR','KB-UPR','KB-SETS','KB-LWR','K-ACC','INFT')
        -- AND A.SITE_NAME='AJMER'
        -- AND A.MONTH_YEAR='MAR_23'
        GROUP BY MONTH_YEAR,SITE_NAME,SITE_CODE
        ,CASE WHEN GROUP_ALIAS IN ('FOOD','N-FOOD','STPLS') THEN 'FMCG'
              WHEN GROUP_ALIAS IN ('MU-TEE','MU-SHRT','M-LWR','M-ETN','M-ACC') THEN 'MENS'
              WHEN GROUP_ALIAS IN ('LU-TOP','LU-ETN','L-LOW','L-ACC','SAR') THEN 'LADIES'
              WHEN GROUP_ALIAS IN ('KG-UPR','KG-SETS','KG-LWR','KB-UPR','KB-SETS','KB-LWR','K-ACC','INFT') THEN 'KIDS'
              ELSE GROUP_ALIAS END) TRGT ,
        --NET SALE AMOUNT AT DIVISION LEVEL FOR FLOOR MANAGERS
        (SELECT MONTH_YEAR,SITE_NAME,ADMSITE_CODE
        ,CASE WHEN GROUP_ALIAS IN ('FOOD','N-FOOD','STPLS') THEN 'FMCG'
              WHEN GROUP_ALIAS IN ('MU-TEE','MU-SHRT','M-LWR','M-ETN','M-ACC') THEN 'MENS'
              WHEN GROUP_ALIAS IN ('LU-TOP','LU-ETN','L-LOW','L-ACC','SAR') THEN 'LADIES'
              WHEN GROUP_ALIAS IN ('KG-UPR','KG-SETS','KG-LWR','KB-UPR','KB-SETS','KB-LWR','K-ACC','INFT') THEN 'KIDS'
              ELSE GROUP_ALIAS END GROUP_ALIAS,SUM(NET_SALE) NET_SALE
         FROM V_HR_INCENTIVE_SALES A 
         WHERE A.GROUP_ALIAS IN ('SAR','FOOD','N-FOOD','STPLS','MU-TEE','MU-SHRT','M-LWR','M-ETN','M-ACC','LU-TOP','LU-ETN','L-LOW','L-ACC','KG-UPR','KG-SETS','KG-LWR','KB-UPR','KB-SETS','KB-LWR','K-ACC','INFT')
        -- AND A.SITE_NAME='AJMER'
        -- AND A.MONTH_YEAR='MAR_23'
        GROUP BY MONTH_YEAR,SITE_NAME,ADMSITE_CODE
        ,CASE WHEN GROUP_ALIAS IN ('FOOD','N-FOOD','STPLS') THEN 'FMCG'
              WHEN GROUP_ALIAS IN ('MU-TEE','MU-SHRT','M-LWR','M-ETN','M-ACC') THEN 'MENS'
              WHEN GROUP_ALIAS IN ('LU-TOP','LU-ETN','L-LOW','L-ACC','SAR') THEN 'LADIES'
              WHEN GROUP_ALIAS IN ('KG-UPR','KG-SETS','KG-LWR','KB-UPR','KB-SETS','KB-LWR','K-ACC','INFT') THEN 'KIDS'
              ELSE GROUP_ALIAS END) NTSL,
              hr_monthlygroupaliasupdate GA,HR_ATTENDANCEWORKPIVOT ATND
        WHERE TRGT.MONTH_YEAR = NTSL.MONTH_YEAR
        AND     TRGT.SITE_CODE = NTSL.ADMSITE_CODE
        AND     TRGT.GROUP_ALIAS = NTSL.GROUP_ALIAS
        AND     TRGT.MONTH_YEAR = GA.MONTHYEAR
        AND     TRGT.SITE_CODE = GA.STORECODE
        AND     TRGT.GROUP_ALIAS = GA.GROUP_ALIAS
        AND     GA.MONTHYEAR=ATND.MONTH_YEAR
        AND     GA.STORECODE=ATND.SITE_CODE
        AND     GA.EMP_CODE=ATND.EMP_CODE
        AND     NTSL.MONTH_YEAR='JUN_23'
        --AND     GA.EMP_CODE='49180'
        --AND     TRGT.SITE_CODE=15
        GROUP BY TRGT.MONTH_YEAR,ATND.EMP_CODE,ATND.EMP_NAME,ATND.DESIGNATION,ATND.TOTAL_PRESENT,TRGT.SITE_NAME,TRGT.SITE_CODE,TRGT.GROUP_ALIAS,TRGT.TARGET_AMT,NTSL.NET_SALE
        /*******************FLOOR MANAGER WISE INCENTIVE END ***********************/
        UNION ALL
        /*******************STORE WISE INCENTIVE ***********************/
         SELECT
        --AS PER STORE TARGET ACHIVEMENT 
        A.MONTH_YEAR
        ,C.EMP_CODE
        ,C.EMP_NAME
        ,D.GROUP_ALIAS
        ,A.SITE_CODE
        ,A.SITE_NAME
        ,C.DESIGNATION
        ,C.TOTAL_PRESENT
        ,SUM(A.TARGET_AMT) TARGET_AMT
        ,SUM(A.NET_SALE) NET_SALE
        ,SUM(DECODE(A.NET_SALE,0,1,A.NET_SALE)/DECODE(A.TARGET_AMT,0,1,A.TARGET_AMT))*100  achibv,
        --SUM(A.NET_SALE)/SUM(A.TARGET_AMT) *100 achibv
        CASE
        WHEN SUM(A.TARGET_AMT)
        <SUM(A.NET_SALE)  AND UPPER(C.DESIGNATION) IN ('ASSTT. STORE MANAGER','ASSTT. STORE MANAGER-FMCG') AND C.TOTAL_PRESENT>=20  THEN 2000
        WHEN SUM(A.TARGET_AMT)
        <SUM(A.NET_SALE)  AND UPPER(C.DESIGNATION) IN ('STORE MANAGER')  AND C.TOTAL_PRESENT>=20 THEN 3000
        WHEN SUM(A.TARGET_AMT)
        <SUM(A.NET_SALE)  AND UPPER(C.DESIGNATION) IN ('MANAGEMENT TRAINEE') AND C.TOTAL_PRESENT>=20 THEN 2000
        WHEN SUM(A.TARGET_AMT)
        <SUM(A.NET_SALE)  AND UPPER(C.DESIGNATION) IN ('HEAD CASHIER') AND C.TOTAL_PRESENT>=20 THEN 750
        WHEN SUM(A.TARGET_AMT)
        <SUM(A.NET_SALE)  AND UPPER(C.DESIGNATION) IN ('VM-STORE') AND C.TOTAL_PRESENT>=20 THEN 750
        WHEN SUM(A.TARGET_AMT)
        <SUM(A.NET_SALE)  AND UPPER(C.DESIGNATION) IN ('RETAIL TRAINEE ASSOCIATE','PRO','SUPPORT STAFF',
        'HOUSE KEEPING','ASSOCIATE ALTERATION','ASSOCIATE BILLING','ASSOCIATE UTILITY') AND C.TOTAL_PRESENT>=20 THEN 500 ELSE 0
        END INCENTIVE
        FROM --SALE TARGET START
        (        SELECT MONTH_YEAR,SITE_NAME,ADMSITE_CODE SITE_CODE,SUM(NVL(NET_SALE,0)) NET_SALE,SUM(NVL(TARGET_AMT,0)) TARGET_AMT
        FROM
        (SELECT MONTH_YEAR,SITE_NAME,ADMSITE_CODE,SUM(NVL(NET_SALE,0)) NET_SALE,0 TARGET_AMT 
        FROM V_HR_INCENTIVE_SALES 
        --WHERE  MONTH_YEAR='JUN_23'
        --AND ADMSITE_CODE='101298' 
        GROUP BY MONTH_YEAR,SITE_NAME,ADMSITE_CODE
        UNION ALL
        SELECT MONTH_YEAR,SITE_NAME,SITE_CODE,0 NET_SALE,SUM(NVL(TARGET_AMT,0)) TARGET_AMT 
        FROM V_HR_INCENTIVE_TARGET 
        --WHERE MONTH_YEAR='JUN_23'
        --AND SITE_CODE='101298'
        GROUP BY MONTH_YEAR,SITE_NAME,SITE_CODE)
        GROUP BY MONTH_YEAR,SITE_NAME,ADMSITE_CODE) A-- SALE TARGET END
        ,hr_monthlygroupaliasupdate D,HR_ATTENDANCEWORKPIVOT C
        WHERE A.MONTH_YEAR= d.MONTHYEAR
        AND A.SITE_CODE = d.STORECODE
        AND D.MONTHYEAR=C.MONTH_YEAR
        AND D.STORECODE=C.SITE_CODE
        AND D.EMP_CODE=C.EMP_CODE
        --AND D.GROUP_ALIAS=C.SUB_DEPARTMENT
        --AND A.SITE_CODE IN ('1')
        --AND A.MONTH_YEAR='JAN_23'
        AND D.GROUP_ALIAS IN ('ASM','ADMIN','VM','HC','SM','MT')
        --AND C.EMP_CODE='41008'
        --AND C.DESIGNATION NOT IN ('Associate','Floor Manager','FMCG-Purchaser')
        AND A.MONTH_YEAR='JUN_23'
        GROUP BY A.MONTH_YEAR
        ,A.SITE_CODE
        ,A.SITE_NAME
        ,C.EMP_CODE
        ,C.EMP_NAME
        ,C.DESIGNATION
        ,D.GROUP_ALIAs
        ,C.TOTAL_PRESENT
        --ORDER BY EMP_CODE ASC
        /*******************STORE WISE INCENTIVE END ***********************/
        );
        
        COMMIT;
END; 
/
